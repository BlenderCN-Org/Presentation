<!DOCTYPE html>
<html lang="en">

<head>
    <title>TimelineJS Example</title>
    <meta charset="utf-8">
    <meta name="description" content="TimelineJS Embed">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <!-- CSS-->
    <link rel="stylesheet" href="css/timeline.css?v1">
    <!--FONT-->
    <link rel="stylesheet" href="css/fonts/font.default.css?v1">
    <!-- Style-->
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            padding: 0px;
            margin: 0px;
        }
        
        .tl-timeline {
            height: 146px
        }
        
        .tl-storyslider {
            display: none;
        }
    </style>
    <!-- HTML5 shim, for IE6-8 support of HTML elements-->
    <!--if lt IE 9
    script(src='https://html5shim.googlecode.com/svn/trunk/html5.js')
    
    -->
</head>

<body>
    <button class="addEvent">Add Event </button>
    <button class="updateEvent">Update Event </button>
    <input type="text" class="input_field"></input>
    <div id="timeline"></div>
    
    <!-- JavaScript-->
    <script src="js/timeline.js"></script>
    <script>
        var data = {
            scales:"human",
	"title": {
            "text": {
                "headline": "Milliseconds",
                "text":     "Testing milliseconds"
            }
    },
    "events": [
        {
            "start_date": {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "minute": 		"0",
                "second": 		"0",
                "millisecond": 	"0"
            },
           "end_date": {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "minute": 		"1",
                "second": 		"0",
                "millisecond": 	"0"
            },
            "text": {
                "headline": "Test",
                "text": "Test"
            }
        },{
            "start_date": {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"02",
                "minute": 		"0",
                "second": 		"0",
                "millisecond": 	"0"
            },
           
            "text": {
                "headline": "Last Slide",
                "text": "Last Slide"
            }
        }
    ]
}



        var config = new TL.TimelineConfig(data);
       var old = TL.AxisHelper.getBestHelper
       TL.Language.languages.en.dateformats.time_short = "MM:ss"
        TL.AxisHelper.getBestHelper = function(ts,optimal_tick_width){
            
            return old(ts, optimal_tick_width)
        }
        // TL.AxisHelper.prototype.getMajorTicks = function(timescale) {
        //     return this._getTicks(timescale, Object.assign({}, this.major, {factor: 1000}) )
        // }

        // TL.AxisHelper.prototype.getMinorTicks = function(timescale) {
        //     return this._getTicks(timescale, Object.assign({}, this.minor, {factor: 1000}) )
        // }
        var timeline = new TL.Timeline('timeline', config, {
      	theme_color: "#288EC3",
      	ga_property_id: "UA-27829802-4",
          timenav_position:'top',
          timenav_height_percentage: 100
      });
      
      var ae = document.querySelector('.addEvent');
      var ue = document.querySelector('.updateEvent');
      var currentSlide = null;
      if(ae){
          var lastyear = 1858
          var lastminut = 1;
        timeline.addEventListener('change', function(e){
            console.log(e);
            var slide = timeline.getCurrentSlide();
            currentSlide = slide;
            console.log(slide);
        })
        var rand = 1;
        ae.addEventListener('click', function(){
            lastminut += rand;
           var newevent =  {
            "start_date": {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "minute": 		"0",
                "second": 		lastminut,
                "millisecond": 	"0"
            },
           "end_date": {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "minute": 		"0",
                "second": 		lastminut + rand,
                "millisecond": 	"0"
            },
            "text": {
                "headline": "Test",
                "text": "Test"
            }
        };
        rand = Math.random() * 30 + 100
        ue.addEventListener('click', function(){
            if(currentSlide && currentSlide.data){
                var data = timeline.getDataById(currentSlide.data.unique_id);
                timeline.removeId(currentSlide.data.unique_id)
                data.end_date.data.minute += 1; 
                var ndata = createNewFromOld(data);
                ndata.end_date.minute += 1; 
                timeline.add(ndata);
                currentSlide = null;
            }
        });
        var createNewFromOld = function (t){
              var newevent =  {
            "start_date": Object.assign({}, {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "second": 		"0",
                "millisecond": 	"0"
            },t.start_date.data),
           "end_date": Object.assign({}, {
                "year":			"2015",
                "month":		"01",
                "day": 			"01",
                "hour": 		"01",
                "second": 		"0",
                "millisecond": 	"0"
            },t.end_date.data),
            "text": {
                "headline": "Test updated",
                "text": "Test updated"
            }
              }
              
              delete(newevent.end_date.date_obj)
              delete(newevent.start_date.date_obj)
            return newevent;
        };
        
        newevent = Object.assign({}, newevent);
        lastyear++;
            timeline.add(newevent)
        })
      }
    </script>

</body>

</html>
